/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
require({cache:{"url:esri/dijit/geoenrichment/templates/EnrichOptionsPage.html":"<div data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-props=\"row: 0\" style=\"padding-bottom: 0;\">\r\n    <div class=\"EnrichOptionsPage_Stacking EnrichOptionsPage_TrimWithEllipsis\">\r\n        ${nls.selectedVariables}\r\n        <span data-dojo-attach-point=\"dataCollectionNames\"></span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"bufferDiv\" class=\"EnrichOptionsPage_Stacking\">\r\n        ${nls.bufferOptions}\r\n        <span data-dojo-attach-point=\"bufferString\"></span>\r\n        <span data-dojo-attach-point=\"bufferEdit\">(<span class=\"Wizard_Link\" data-dojo-attach-event=\"click: _editBuffer\">${nls.edit}</span>)</span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"bufferEditDiv\" class=\"Wizard_AltRow EnrichOptionsPage_Stacking\" style=\"display: none;\"></div>\r\n    <div data-dojo-attach-point=\"totalVars\" class=\"EnrichOptionsPage_Stacking\">&nbsp;</div>\r\n</div>\r\n<div data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-attach-point=\"fieldsPane\" data-dojo-props=\"row: 1\" style=\"padding-top: 0; padding-bottom: 0;\">\r\n    <div data-dojo-attach-point=\"fieldsDiv\" class=\"EnrichOptionsPage_Fields\"></div>\r\n</div>\r\n<div data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-props=\"row: 2\" style=\"padding-top: 0;\">\r\n    <div data-dojo-attach-point=\"overwriteExisting\" class=\"EnrichOptionsPage_OverwriteExisting EnrichOptionsPage_Stacking\">${nls.overwriteExisting}</div>\r\n    <button class=\"Wizard_Button\" data-dojo-attach-point=\"backButton\" data-dojo-attach-event=\"click: _back\">${nls.back}</button>\r\n    <button class=\"Wizard_Button\" data-dojo-attach-point=\"finishButton\" data-dojo-attach-event=\"click: _finish\" disabled=\"disabled\">${nls.finish}</button>\r\n</div>\r\n"}});define("esri/dijit/geoenrichment/EnrichOptionsPage",["../../declare","dojo/_base/lang","dojo/dom-construct","dojo/dom-class","dojo/Stateful","dojo/number","dojo/string","dojo/aspect","./_WizardPage","dojo/i18n!../../nls/jsapi","dojo/text!./templates/EnrichOptionsPage.html","../../tasks/geoenrichment/RingBuffer","../../tasks/geoenrichment/DriveBuffer","./BufferOptions","dojox/html/entities","./_Invoke","dgrid/OnDemandGrid","dgrid/extensions/DijitRegistry","dojo/store/Memory","dojo/data/ObjectStore","dgrid/tree","dijit/form/Select","dijit/form/CheckBox","dojox/mvc/sync","./config","esri/request","../../lang","dijit/layout/ContentPane","dijit/form/NumberSpinner","dijit/form/RadioButton"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a,_1b){_a=_a.geoenrichment.dijit.EnrichOptionsPage;var _1c="_";var _1d=_1([_14],{getChildren:function(_1e){return _1e.getChildren();},mayHaveChildren:function(_1f){return !!_1f.getChildren;}});var _20=_1([_5],{checked:true,getLabel:function(){},getClass:function(){return "";}});var _21=_1([_20],{_children:null,constructor:function(_22,_23,_24){this.set("id2",_22.id);this._children=[];for(var i=0;i<_22.variables.length;i++){var _25=new _26(_22.variables[i],_24);var _27=_22.id+"."+_22.variables[i].id;_25.set("id2",_27);var _28=_23[_27];_25.set("checked",_2.isString(_28));if(_28){_25.set("mapTo",_28);}this._children.push(_25);}},_checkedSetter:function(_29){this.checked=_29;if(this._children){for(var i=0;i<this._children.length;i++){this._children[i].set("checked",this.checked);}}},getLabel:function(){return this.metadata.title;},getChildren:function(){return this._children;}});var _26=_1([_20],{mapTo:null,_page:null,constructor:function(_2a,_2b){this._page=_2b;},_checkedSetter:function(_2c){if(this.checked==_2c){return;}this.checked=_2c;this._page.invoke("_updateTotalVars");},_mapToSetter:function(_2d){if(this.mapTo==_2d){return;}this.mapTo=_2d;this._page.invoke("_updateTotalVars");},getLabel:function(){return this.alias;},getClass:function(){return "EnrichOptionsPage_VariableCheckbox";},getOptions:function(){var _2e=[];_2e.push({value:_1c,label:_f.encode(this._page.allowNewColumns?_a.newColumn:_a.noColumn)});if(this._page.fields){for(var i=0;i<this._page.fields.length;i++){var _2f=this._page.fields[i];if(_2f.type&&_2f.type!=this.type){var _30=false;if(_2f.type=="esriFieldTypeInteger"&&this.type=="esriFieldTypeDouble"&&this.precision==0){_30=true;}else{if(this.type=="esriFieldTypeInteger"&&_2f.type=="esriFieldTypeDouble"){_30=true;}}if(!_30){continue;}}_2e.push({value:_2f.id,label:_f.encode(_2f.label||_2f.id)});}}return _2e;}});var _31=_1([_11,_12],{removeRow:function(_32,_33){var _34=dijit.findWidgets(_32);if(_34){for(var i=0;i<_34.length;i++){_34[i].destroy();}}this.inherited(arguments);}});var _35=_1("esri.dijit.geoenrichment.EnrichOptionsPage",[_9,_10],{templateString:_b,nls:_a,geomType:null,buffer:null,fields:null,allowNewColumns:true,dataCollections:null,studyAreaCount:null,_bufferOptions:null,_fieldSelects:null,_grid:null,_model:null,_eventMap:{"back":true,"finish":true},constructor:function(){this.buffer=new _c();},_setGeomTypeAttr:function(_36){this._set("geomType",_36);switch(this.geomType){case "esriGeometryPolygon":this.bufferEdit.style.display="none";this.bufferString.innerHTML=_a.bufferPolygon;break;case "esriGeometryPoint":this.bufferEdit.style.display="";this.bufferString.innerHTML=_a.bufferRing;break;case "esriGeometryPolyline":this.bufferEdit.style.display="";this.bufferString.innerHTML=_a.bufferRing;this.driveTimeRadio.set("disabled",true);break;}},_setFieldsMapAttr:function(_37){var _38={};for(var _39 in _37){_38[_39.split(".")[0]]=true;}var _3a=[];this._model=[];for(var i=0;i<this.dataCollections.length;i++){if(!_38[this.dataCollections[i].id]){continue;}_3a.push(this.dataCollections[i].metadata.title);this._model.push(new _21(this.dataCollections[i],_37,this));}this.dataCollectionNames.innerHTML=_3a.join(", ");this.dataCollectionNames.title=_3a.join("\n");var _3b=new _13({data:this._model,idProperty:"id2"});var _3c=new _1d(_3b);if(!this._grid){var _3d=[_15({label:" ",field:"expander",shouldExpand:_2.hitch(this,this._shouldExpand)}),{label:_a.varName,field:"varName",sortable:false,renderCell:_2.hitch(this,this._renderCheckBox)}];if(this.fields){_3d.push({label:_a.column,field:"column",sortable:false,renderCell:_2.hitch(this,this._renderSelect)});}this._grid=new _31({store:_3c,columns:_3d},this.fieldsDiv);_8.after(this._grid,"expand",_2.hitch(this,this.invoke,"resize"));this._grid.startup();}else{this._grid.set("store",_3c);}this.invoke("_updateTotalVars");},_shouldExpand:function(row,_3e,_3f){if(_3f!==undefined){return _3f;}return this._model.length==1;},_renderCheckBox:function(_40,_41,_42,_43){var _44=new _17();var _45=_40.getLabel();_18(_40,"checked",_44,"checked");var _46=_3.create("label",{"class":"EnrichOptionsPage_TrimWithEllipsis EnrichOptionsPage_CheckboxLabel",title:_45});_4.add(_46,_40.getClass());_44.placeAt(_46);_3.create("span",{innerHTML:_45},_46);return _46;},_renderSelect:function(_47,_48,_49,_4a){if(_47.getOptions){var _4b=new _16({options:_47.getOptions(),maxHeight:151});_18(_47,"mapTo",_4b,"value",{converter:{format:function(_4c){return _4c||_1c;},parse:function(_4d){return _4d!=_1c?_4d:null;}}});return _4b.domNode;}},_updateTotalVars:function(){var _4e=this;var _4f=0;var _50=false;this._enumCheckedVars(function(dc,v){_4f++;if(v.mapTo){_50=true;}});this.overwriteExisting.style.visibility=_50?"visible":"hidden";this.finishButton.disabled=_4f==0;var _51={enrichVariableCount:_4f,f:"json"};if(this.get("buffer") instanceof _d){_51.serviceAreaCount=1;}var _52,_53;if(this.studyAreaCount){_52=_a.totalVars;_53=_a.totalVarsTooltip;rowCount=this.studyAreaCount;}else{_52=_a.varsPerRow;_53=_a.varsPerRowTooltip;rowCount=1;}if(_19.token){_51.token=_19.token;}function _54(_55,_56){if(_1b.isNumber(_55)){_55=_7.substitute(_a.credits,{credits:_6.format(_55)});}var map={varCount:_4f,rowCount:rowCount,credits:_55};_4e.totalVars.innerHTML=_7.substitute(_52,map);if(_56===undefined){_56=_7.substitute(_53,map);}_4e.totalVars.title=_56;};_54(_a.creditsCalc,"");_1a({url:_19.portalUrl+"/sharing/rest/portals/self/cost",content:_51}).then(function(_57){_54(_57.transactionCreditCost*rowCount);},function(_58){_54("error",_58.toString());});},_getBufferAttr:function(){if(this._bufferOptions){return this._bufferOptions.get("buffer");}else{return this.buffer;}},_setBufferAttr:function(_59){this._set("buffer",_59);if(this._bufferOptions){this._bufferOptions.set("buffer",_59);}},_editBuffer:function(){_3.destroy(this.bufferDiv);this.bufferEditDiv.style.display="";this._bufferOptions=new _e({buffer:this.buffer,onChange:_2.hitch(this,this.invoke,"_updateTotalVars")});this.buffer=undefined;this._bufferOptions.placeAt(this.bufferEditDiv);this.resize();},_getFieldsMapAttr:function(){var map={};this._enumCheckedVars(function(dc,v){map[dc.id+"."+v.id]=v.mapTo||"";});return map;},_enumCheckedVars:function(_5a){for(var i=0;i<this._model.length;i++){var _5b=this._model[i].getChildren();for(var j=0;j<_5b.length;j++){if(!_5b[j].checked){continue;}if(!this.allowNewColumns&&!_5b[j].mapTo){continue;}_5a(this._model[i],_5b[j]);}}},_back:function(){this.onBack();},onBack:function(){},_finish:function(){this.onFinish();},onFinish:function(){}});return _35;});